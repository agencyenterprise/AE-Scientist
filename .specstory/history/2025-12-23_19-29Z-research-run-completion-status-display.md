<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session ce5a1666-e2ae-4d3b-a1fa-9ce39ab161a7 (2025-12-23 19:29Z) -->

# Research run completion status display (2025-12-23 19:29Z)

_**User (2025-12-23 14:45Z)**_

From here http://localhost:3000/research runs which are completed shows under Stage as 5: Ppaer Generation. But once Completed, it should show "Completed" there instead - can you fix this?

---

_**Agent (model claude-4.5-opus-high-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
The user wants to change the display of the "Stage" column in the research runs table. When a run is completed, instead of showing "5: Paper Generation", it should show "Completed".

Let me first find where this stage display logic is implemented. It's likely in the frontend code related to research runs.</details></think>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where is the Stage column displayed for research runs in the dashboard table?" • **13** results</summary>
            
| File | Lines |
|------|-------|
| `frontend/src/features/research/components/ResearchBoardTable.tsx` | L7-42 |
| `frontend/src/features/research/components/run-detail/research-pipeline-stages.tsx` | L233-485 |
| `frontend/src/features/research/components/research-board-card-body.tsx` | L6-76 |
| `frontend/src/app/(dashboard)/research/[runId]/page.tsx` | L26-237 |
| `frontend/src/features/research/components/run-detail/research-run-stats.tsx` | L6-57 |
| `frontend/src/features/research/utils/research-utils.tsx` | L183-223 |
| `frontend/src/features/research/components/run-detail/research-stage-progress.tsx` | L2-52 |
| `frontend/src/types/research.ts` | L25 |
| `frontend/src/features/research/utils/research-utils.tsx` | L27-76 |
| `frontend/src/features/research/components/ResearchHistoryCard.tsx` | L15-86 |
| `frontend/src/features/research/utils/research-utils.tsx` | L22-46 |
| `frontend/src/types/research.ts` | L198-222 |
| `frontend/src/types/research.ts` | L22-48 |

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
I found `getStageBadge` and `getCurrentStageLabel` functions in `research-utils.tsx`. Let me look at these functions more closely to understand the logic and fix it for completed runs.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jpbowler/code/ae/AE-Scientist/frontend/src/features/research/utils/research-utils.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Now I see the issue. The `getStageBadge` function at line 195-213 doesn't take into account the status of the run. It just formats whatever stage is passed to it.

Let me check where `getStageBadge` is called from in `research-board-card-body.tsx`:

```tsx
{getStageBadge(currentStage) || (
  <span className="text-sm text-slate-500">Not started</span>
)}
```

It only passes `currentStage`, not the status. So when the run is completed with `status === "completed"`, the `getStageBadge` function doesn't know about it and still shows "5: Paper Generation".

There are two ways to fix this:
1. Modify `getStageBadge` to accept status as an additional parameter
2. Modify the caller to handle completed status before calling `getStageBadge`

Looking at the code, I think the best approach is to modify `getStageBadge` to accept an optional status parameter and return "Completed" when status is "completed". This is cleaner because it keeps the logic in one place.

Let me also look at `research-board-card-body.tsx` to see how the component is being called and to understand the data flow better.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jpbowler/code/ae/AE-Scientist/frontend/src/features/research/components/research-board-card-body.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Now I understand the issue. The `getStageBadge(currentStage)` is called without the `status` parameter, so it always shows the stage name even when the run is completed.

The fix is to modify `getStageBadge` to accept an optional `status` parameter, and if `status === "completed"`, show "Completed" instead of the stage name. Then update the caller in `research-board-card-body.tsx` to pass the status.

Let me make these changes:

1. Update `getStageBadge` to accept an optional `status` parameter
2. Update the call in `research-board-card-body.tsx` to pass the status</details></think>

---

Now I understand the issue. The `getStageBadge` function doesn't account for the run status - it just displays whatever stage is passed to it. When a run is completed, it still shows "5: Paper Generation" instead of "Completed".

I'll fix this by modifying `getStageBadge` to accept an optional `status` parameter and return "Completed" when appropriate:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/jpbowler/code/ae/AE-Scientist/frontend/src/features/research/utils/research-utils.tsx</summary>

**Chunk 1**
Lines added: 20, lines removed: undefined

```diff
@@ -190,11 +190,31 @@
   * Returns a styled stage badge for a research pipeline stage
   * @param stage - Pipeline stage string (baseline, tuning, plotting, ablation)
+  * @param status - Optional run status to check for completed/failed states
   * @param configs - Optional custom stage configurations (Open/Closed compliant)
   * @returns React element with styled badge, or null if no stage
   */
  export function getStageBadge(
    stage: string | null,
+   status?: string | null,
    configs: StageBadgeConfig[] = DEFAULT_STAGE_CONFIGS
  ): ReactNode {
+   // If status is completed, show "Completed" badge
+   if (status === "completed") {
+     return (
+       &lt;span className="inline-flex rounded-lg border px-2.5 py-1 text-xs font-medium bg-emerald-500/15 text-emerald-400 border-emerald-500/30"&gt;
+         Completed
+       &lt;/span&gt;
+     );
+   }
+ 
+   // If status is failed, show "Failed" badge
+   if (status === "failed") {
+     return (
+       &lt;span className="inline-flex rounded-lg border px-2.5 py-1 text-xs font-medium bg-red-500/15 text-red-400 border-red-500/30"&gt;
+         Failed
+       &lt;/span&gt;
+     );
+   }
+ 
    if (!stage) return null;
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Now I need to update the call site in `research-board-card-body.tsx` to pass the status:</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/jpbowler/code/ae/AE-Scientist/frontend/src/features/research/components/research-board-card-body.tsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -51,5 +51,5 @@
              Stage
            &lt;/p&gt;
-           {getStageBadge(currentStage) || (
+           {getStageBadge(currentStage, status) || (
              &lt;span className="text-sm text-slate-500"&gt;Not started&lt;/span&gt;
            )}
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Let me check if there are any other places where `getStageBadge` is called to make sure they still work correctly with the new signature.</details></think>

---

Let me check if there are other places using `getStageBadge` that might need updating:

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "getStageBadge\(" in "/Users/jpbowler/code/ae/AE-Scientist/frontend" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `frontend/src/features/research/components/research-board-card-body.tsx` | `\{getStageBadge(currentStage, status) \|\| (` | L53 |
| `frontend/src/features/research/utils/research-utils.tsx` | `export function getStageBadge(` | L196 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Good - `getStageBadge` is only called in one place (`research-board-card-body.tsx`), and I've already updated that call. Let me verify there are no linting errors:</details></think>

---

Good, there's only one call site and I've already updated it. Let me verify there are no linting errors:

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 2 files</summary>
      
Lint paths:

- `/Users/jpbowler/code/ae/AE-Scientist/frontend/src/features/research/utils/research-utils.tsx`
- `/Users/jpbowler/code/ae/AE-Scientist/frontend/src/features/research/components/research-board-card-body.tsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
The changes are complete. Let me summarize what I changed:1. In `research-utils.tsx`, I updated `getStageBadge` function to accept an optional `status` parameter:
   - If `status === "completed"`, it returns a "Completed" badge with emerald styling
   - If `status === "failed"`, it returns a "Failed" badge with red styling
   - Otherwise, it behaves the same as before

2. In `research-board-card-body.tsx`, I updated the call to `getStageBadge` to pass the `status` parameter.

Now when a run is completed, the Stage column will show "Completed" instead of "5: Paper Generation".</details></think>

---

Done! I've updated the `getStageBadge` function to accept an optional `status` parameter. Now:

- When `status === "completed"`, it shows a "Completed" badge with emerald green styling
- When `status === "failed"`, it shows a "Failed" badge with red styling  
- Otherwise, it shows the stage name as before

The call in `research-board-card-body.tsx` has been updated to pass the status to the function. Completed runs will now display "Completed" instead of "5: Paper Generation" in the Stage column.

---

